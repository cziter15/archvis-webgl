(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}})();class U{static architectureToXML(t){let r=`<?xml version="1.0" encoding="UTF-8"?>
`;return r+=`<arch>
`,r+=`  <node name="${t.root.name}" pos="${t.root.pos.join(",")}" color="${t.root.color}" scale="${t.root.scale}">
`,t.root.children.forEach(o=>{r+=this.nodeToXML(o,2)}),r+=`  </node>
`,t.legend&&t.legend.length>0&&(r+=`  <legend>
`,t.legend.forEach(o=>{r+=`    <entry name="${o.name}" color="${o.color}" />
`}),r+=`  </legend>
`),t.uiInfo&&t.uiInfo.title&&(r+=`  <ui-info>
`,r+=`    <title>${t.uiInfo.title}</title>
`,r+=`  </ui-info>
`),r+="</arch>",r}static nodeToXML(t,r){let o="";const n=" ".repeat(r);return o+=`${n}<node name="${t.name}" pos="${t.pos.join(",")}" color="${t.color}"`,t.scale!==void 0&&(o+=` scale="${t.scale}"`),t.children&&t.children.length>0?(o+=`>
`,t.children.forEach(i=>{o+=this.nodeToXML(i,r+2)}),o+=`${n}</node>
`):o+=` />
`,o}static xmlToArchitecture(t){const o=new DOMParser().parseFromString(t,"text/xml"),n=o.querySelector("arch > node");if(!n)throw new Error("Root element not found in XML");const i={name:n.getAttribute("name"),pos:n.getAttribute("pos").split(",").map(Number),color:n.getAttribute("color"),scale:parseFloat(n.getAttribute("scale")),children:[]};n.querySelectorAll(":scope > node").forEach(l=>{const p=this.parseNode(l);i.children.push(p)});const u=[],g=o.querySelector("arch > legend");g&&g.querySelectorAll("entry").forEach(p=>{const M={name:p.getAttribute("name"),color:p.getAttribute("color")};u.push(M)});const y={title:""},E=o.querySelector("arch > ui-info");if(E){const l=E.querySelector("title");l&&(y.title=l.textContent||"")}return{root:i,legend:u,uiInfo:y}}static parseNode(t){const r={name:t.getAttribute("name"),pos:t.getAttribute("pos").split(",").map(Number),color:t.getAttribute("color"),children:[]},o=t.getAttribute("scale");return o&&(r.scale=parseFloat(o)),t.querySelectorAll(":scope > node").forEach(i=>{const c=this.parseNode(i);r.children.push(c)}),r}}let s={root:{name:"Empty Architecture",pos:[0,0,0],color:"#666666",scale:1,children:[]},legend:[],uiInfo:{title:""}},H=!0,A=!0;window.smoothFactors||(window.smoothFactors={drag:.25,zoom:.15,general:.12});function h(e){const t=document.getElementById("messageDisplay"),r=document.createElement("div");r.className="message",r.textContent=e,t.appendChild(r),setTimeout(()=>r.remove(),5e3)}function V(){const e=document.getElementById("legendContainer"),t=document.getElementById("legendItems");s.legend&&s.legend.length>0?(e.style.display="block",t.innerHTML="",s.legend.forEach(r=>{const o=document.createElement("div");o.className="legend-entry",o.innerHTML=`
						<div class="legend-color" style="background-color: ${r.color};"></div>
						<span style="color: white;">${r.name}</span>
					`,t.appendChild(o)})):e.style.display="none"}function W(){const e=document.getElementById("title");e.textContent=s.uiInfo?.title||"ARCHITECTURE VISUALIZATION"}document.getElementById("saveBtn").addEventListener("click",()=>{if(s.root.name==="Empty Architecture"||!s.root.name){h("No architecture to save. Please load an architecture first.");return}const e=U.architectureToXML(s),t=new Blob([e],{type:"application/xml"}),r=URL.createObjectURL(t),o=document.createElement("a");o.href=r,o.download="architecture.xml",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(r),h("Architecture saved successfully!")});document.getElementById("loadBtn").addEventListener("click",()=>{document.getElementById("xmlFileInput").click()});document.getElementById("xmlFileInput").addEventListener("change",e=>{const t=e.target.files[0];if(!t)return;const r=new FileReader;r.onload=o=>{try{const n=o.target.result;if(!n||n.trim()==="")throw new Error("Empty file");const i=U.xmlToArchitecture(n);if(!i||!i.root)throw new Error("Invalid architecture structure");s={root:i.root||{name:"Unknown Root",pos:[0,0,0],color:"#ff00ff",scale:1,children:[]},legend:i.legend||[],uiInfo:i.uiInfo||{title:""}},V(),W(),ee(),h("Architecture loaded successfully!")}catch(n){h("Error loading XML file: "+n.message)}},r.readAsText(t),e.target.value=""});document.getElementById("sampleBtn").addEventListener("click",()=>{const e=`<?xml version="1.0" encoding="UTF-8"?>
<arch>
  <node name="ROOT" pos="0,0,0" color="#00ffff" scale="1">
	<node name="API Gateway" pos="10,5,0" color="#ff00ff" scale="0.8">
	  <node name="Auth Service" pos="15,8,5" color="#ffff00" scale="0.6" />
	  <node name="Rate Limiter" pos="15,8,-5" color="#ffff00" scale="0.6" />
	</node>
	<node name="Database Layer" pos="-10,5,0" color="#00ff00" scale="0.8">
	  <node name="Primary DB" pos="-15,8,5" color="#ffff00" scale="0.6" />
	  <node name="Cache" pos="-15,8,-5" color="#ffff00" scale="0.6" />
	</node>
	<node name="Workers" pos="0,-5,10" color="#ff6600" scale="0.8">
	  <node name="Job Queue" pos="5,-8,15" color="#ffff00" scale="0.6" />
	  <node name="Worker Pool" pos="-5,-8,15" color="#ffff00" scale="0.6" />
	</node>
  </node>
  <legend>
	<entry name="Core Services" color="#00ffff" />
	<entry name="Modules" color="#ff00ff" />
	<entry name="Components" color="#ffff00" />
	<entry name="Data Layer" color="#00ff00" />
  </legend>
  <ui-info>
	<title>MICROSERVICES ARCHITECTURE</title>
  </ui-info>
</arch>`;try{s=U.xmlToArchitecture(e),V(),W(),ee(),h("Sample architecture loaded successfully!")}catch(t){h("Error loading sample: "+t.message)}});document.getElementById("smoothnessSlider").addEventListener("change",e=>{const r=.55-parseFloat(e.target.value);window.smoothFactors={drag:r,zoom:r*.8,general:r*1.2};const o=Math.round((.55-r)/.45*100);document.getElementById("smoothnessDisplay").textContent=o+"%",h(`Smoothness set to ${o}%`)});document.addEventListener("keydown",e=>{e.key.toLowerCase()==="u"&&(H=!H,document.getElementById("rightPanel").style.display=H?"block":"none",document.getElementById("leftPanel").style.display=H?"block":"none",document.getElementById("uiToggle").classList.toggle("visible",!H)),e.key.toLowerCase()==="q"&&(A=!A,document.body.style.cursor=A?"default":"none",h(`Cursor ${A?"visible":"hidden"}`))});const d=new THREE.Scene;d.fog=new THREE.FogExp2(1296,.008);const m=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.1,1e3);m.position.set(0,15,50);m.lookAt(0,0,0);const b=new THREE.WebGLRenderer({antialias:!0,alpha:!0});b.setSize(window.innerWidth,window.innerHeight);b.setClearColor(1296);document.getElementById("canvas").appendChild(b.domElement);const ie=new THREE.AmbientLight(1710654,.8);d.add(ie);const j=new THREE.PointLight(65535,1.5,60);j.position.set(15,15,15);d.add(j);const Z=new THREE.PointLight(16711935,1.5,60);Z.position.set(-15,10,-15);d.add(Z);const J=new THREE.PointLight(16777215,1,40);J.position.set(0,20,0);d.add(J);const K=new THREE.GridHelper(100,100,65535,657966);K.position.y=-18;d.add(K);const P=[],D=[];function se(e,t){const r=document.createElement("canvas"),o=r.getContext("2d");r.width=1024,r.height=128,o.clearRect(0,0,r.width,r.height),o.font="Bold 60px Courier New, monospace",o.textAlign="center",o.textBaseline="middle",o.shadowColor=t,o.shadowBlur=15,o.fillStyle=t,o.fillText(e.toUpperCase(),r.width/2,r.height/2);const n=new THREE.CanvasTexture(r);n.needsUpdate=!0;const i=new THREE.PlaneGeometry(4.5,.56),c=new THREE.MeshBasicMaterial({map:n,transparent:!0,side:THREE.DoubleSide,depthTest:!0}),u=new THREE.Mesh(i,c),g=new THREE.PlaneGeometry(4.6,.66),y=new THREE.MeshBasicMaterial({color:1296,transparent:!0,opacity:.8,side:THREE.DoubleSide}),E=new THREE.Mesh(g,y);E.position.z=-.05;const l=new THREE.Group;l.add(E),l.add(u);const p=new THREE.EdgesGeometry(new THREE.PlaneGeometry(4.6,.66)),M=new THREE.LineBasicMaterial({color:t,linewidth:2}),w=new THREE.LineSegments(p,M);return l.add(w),l}function Q(e,t,r,o=1){const n=new THREE.Group,i=new THREE.Group,c=new THREE.BoxGeometry(.6*o,.6*o,.6*o),u=new THREE.EdgesGeometry(c),g=new THREE.LineBasicMaterial({color:r,linewidth:2}),y=new THREE.LineSegments(u,g);i.add(y);const E=new THREE.BoxGeometry(.4*o,.4*o,.4*o),l=new THREE.MeshBasicMaterial({color:r,transparent:!0,opacity:.3,wireframe:!0}),p=new THREE.Mesh(E,l);i.add(p);const M=new THREE.PointLight(r,.5,5);i.add(M),n.add(i);try{const w=se(e,r);w.position.y=1.5*o,n.add(w)}catch(w){console.warn("Failed to create text mesh:",w)}return n.position.set(...t),n.userData={name:e,rotationSpeed:Math.random()*.01+.005,rotatingGroup:i},d.add(n),P.push(n),n}function ae(e,t,r,o=.5){const n=[new THREE.Vector3(...e),new THREE.Vector3(...t)],i=new THREE.BufferGeometry().setFromPoints(n),c=new THREE.LineBasicMaterial({color:r,transparent:!0,opacity:o}),u=new THREE.Line(i,c);d.add(u),D.push(u)}function _(e,t,r,o){e.forEach(n=>{if(n.name){const i=Q(n.name,n.pos,n.color,n.scale||1);ae(r,n.pos,o),n.children&&n.children.length>0&&_(n.children,i,n.pos,n.color)}})}function ee(){if(P.forEach(e=>d.remove(e)),D.forEach(e=>d.remove(e)),P.length=0,D.length=0,s.root.name&&s.root.name!=="Empty Architecture"){const e=Q(s.root.name,s.root.pos,s.root.color,s.root.scale);s.root.children&&s.root.children.length>0&&_(s.root.children,e,s.root.pos,s.root.color)}}const te=new THREE.BufferGeometry,oe=1500,ne=new Float32Array(oe*3);for(let e=0;e<oe*3;e++)ne[e]=(Math.random()-.5)*100;te.setAttribute("position",new THREE.BufferAttribute(ne,3));const ce=new THREE.PointsMaterial({size:.05,color:65535,transparent:!0,opacity:.6}),$=new THREE.Points(te,ce);d.add($);const a={w:!1,a:!1,s:!1,d:!1,shift:!1,space:!1};let f=0,z=0,I=50,S=50,O=15,k=15,v=0,T=0,C=0,G=0,B=0,R=0,N=!1,X=!1,L=0,x=0,F=!0,Y,q=0;function le(){clearTimeout(Y),Y=setTimeout(()=>{F=!0},3e3)}document.addEventListener("keydown",e=>{const t=e.key.toLowerCase();t==="w"&&(a.w=!0),t==="a"&&(a.a=!0),t==="s"&&(a.s=!0),t==="d"&&(a.d=!0),e.key==="Shift"&&(a.shift=!0),e.key===" "&&(a.space=!0),e.key==="Escape"&&document.pointerLockElement===document.getElementById("canvas")&&document.exitPointerLock()});document.addEventListener("keyup",e=>{const t=e.key.toLowerCase();t==="w"&&(a.w=!1),t==="a"&&(a.a=!1),t==="s"&&(a.s=!1),t==="d"&&(a.d=!1),e.key==="Shift"&&(a.shift=!1),e.key===" "&&(a.space=!1)});document.addEventListener("mousedown",e=>{e.button===0?(N=!0,L=e.clientX,x=e.clientY,F=!1):(e.button===1||e.button===2)&&(e.preventDefault(),X=!0,L=e.clientX,x=e.clientY,F=!1)});document.addEventListener("mouseup",()=>{N=!1,X=!1});document.addEventListener("contextmenu",e=>e.preventDefault());document.addEventListener("mousemove",e=>{if(N){const t=e.clientX-L,r=e.clientY-x;z-=t*.008,k+=r*.15,k=Math.max(-20,Math.min(35,k)),L=e.clientX,x=e.clientY}else if(X){const t=e.clientX-L,r=e.clientY-x,o=new THREE.Vector3(Math.cos(f),0,-Math.sin(f)),n=.08;T+=o.x*t*n,R+=o.z*t*n,G-=r*n,L=e.clientX,x=e.clientY}});document.addEventListener("wheel",e=>{e.preventDefault();const t=e.deltaY*.03;S+=t,S=Math.max(15,Math.min(100,S))},{passive:!1});function re(){requestAnimationFrame(re),q++,F&&(z+=.001),(N||X)&&le();const e=window.smoothFactors||{drag:.25,zoom:.15,general:.12};f+=(z-f)*e.drag,I+=(S-I)*e.zoom,O+=(k-O)*e.drag,v+=(T-v)*e.general,C+=(G-C)*e.general,B+=(R-B)*e.general;const t=new THREE.Vector3(-Math.sin(f),0,-Math.cos(f)),r=new THREE.Vector3(Math.cos(f),0,-Math.sin(f)),o=.3;a.w&&(T+=t.x*o,R+=t.z*o),a.s&&(T-=t.x*o,R-=t.z*o),a.a&&(T-=r.x*o,R-=r.z*o),a.d&&(T+=r.x*o,R+=r.z*o),a.space&&(G+=o),a.shift&&(G-=o),m.position.x=v+Math.sin(f)*I,m.position.z=B+Math.cos(f)*I,m.position.y=C+O,m.lookAt(v,C,B),P.forEach(n=>{n.userData.rotatingGroup&&(n.userData.rotatingGroup.rotation.y+=n.userData.rotationSpeed,n.userData.rotatingGroup.rotation.x+=n.userData.rotationSpeed*.5)}),D.forEach((n,i)=>{n.material.opacity=.3+Math.sin(q*.05+i)*.2}),$.rotation.y+=3e-4,$.rotation.x+=1e-4,b.render(d,m)}re();window.addEventListener("resize",()=>{m.aspect=window.innerWidth/window.innerHeight,m.updateProjectionMatrix(),b.setSize(window.innerWidth,window.innerHeight)});
